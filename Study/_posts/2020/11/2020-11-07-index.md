---
layout: post
title: MongoDB University, M201 코스 정리
description: >
  MongoDB UniverSity의 M201 ( Index, Performance ) 파트 정리
author: author
comments: true
---

M201 코스 정리 (1)

## Lesson 2.1 Introduction to Indexes
### What are Indexes?
우리는 인덱스를 통해 어떤 것을 해결할 수 있을까요?
> 슬로우 쿼리 입니다.

데이터 베이스의 인덱스는 마치 책의 목차와 근본적으로 동일합니다. 여기서 책은 Collection에 해당합니다.
만약 컬렉션에 인덱스를 사용하지 않으면 데이터베이스는 특정 document를 찾기위해 전체를 훑어봐야 합니다.
이러한 경우를 Collection Scan이라 부릅니다. Collection의 크기가 커질수록 선형적으로 검색 속도가
증가합니다. MonboDB의 인덱스는 B-tree구조로 되어 있습니다. 따라서 Collection의 크기가 증가해도
인덱스를 사용하면 필요한 document를 찾기위해 비교하는 횟수는 log(N)의 복잡도를 가집니다.

### Index OverHead
인덱스를 사용하면 Read를 할 때 엄청난 퍼포먼스를 보여주지만 그에 대한 댓가가 따릅니다. 그것은
인덱스가 추가되면 될 수록 Write하는데 시간이 더 걸리게 되는 것입니다. 새로운 Document가 추가될 때 마다
Collection과 Index가 업데이트 되어야 하기 때문입니다. Document가 수정되거나 완전히 제거될 때도
마찬가지로 B-tree가 업데이트 되어야 합니다. 따라서 중요하지 않은 키에 인덱스를 걸게되면 insert, update,
delete를 하는 경우에 불필요한 퍼포먼스 저하가 일어나게 됩니다. 따라서 인덱스에도 무조건 적인 장점만
있는 것이 아니기 때문에 어떻게 동작하는지, 인덱스의 장점과 단점은 무엇인지를 명확하게 알아야합니다.



### How do they work?
데이터베이스는 데이터를 영구히 저장하기 위해 서버의 파일시스템을 사용합니다. 그렇다면 데이터베이스가
어떤 파일에 어떤 정보를 기록하게 될까요? 데이터베이스가 어떤 자료구조와 스토리지 엔진을 사용하여 Collection과
Index를 구성하고 데이터를 영구히 기록하게 될까요?

### How Data Is Stored on Disk
#### Data Management Object - Collection Data / Index
MongoDB에서 데이터를 저장하는 방식은 MongoDB가 지원하는 스토리지 엔진마다 차이가 있습니다만 여기에선
그런 디테일을 건너뛰고 좀 더 거시적인 수준에서 스토리지 엔진이 어떻게 데이터를 구성하는지 알아보겠습니다.
WiredTiger에서는 3가지 방식이 있다
Plain Flat - 하나의 경로에서 collection, index
DirectoryPerDB - 디비마다 경로가 생기고 collection, index
WiredTigerIndexPerDB - 디비마다 경로가 생기고 collection / index 별로 구분 됨
> 서버에 여러개의 디스크가 있는 경우 I/O 병렬화가 사용되엉 퍼포먼스 향상, 전체적인 처리량 향상

#### Data Compression
Disk에 데이터를 저장할 때 압축을 하게 되는데 이것은 더욱 적은 I/O 오퍼레이션을 요구하므로 더욱 성능향상에
직접적인 연관을 줍니다. 데이터가 디스크에 써지기 전에 먼저 RAM에 올라가게 되고 그 이후에 디스크에 써지는데
이 경우에 writeConcern 설정을 이용하여 메모리에서 디스크에 쓰일 때 어떤 정책을 선택할 것인지 유저사이드에서
결정할 수 있으며 그 외에는 내부에서 메모리와 디스크의 싱크를 맞추는 주기에 따라 메모리에서 디스크로 쓰이고
flush가 됩니다. 저널 또한 중요한 메커니즘 중 하나로서 저널파일은 완전히 저장되지 않은 파일에 대한 안전망입니다
시스템ㅇ이 갑자기 꺼져서 데이터가 file로 쓰여지지 않은 경우 저널 파일에서 이를 복구하게 됩니다. 파일을
insert할 때도 저널과 동기화를 거쳐서 disk에 쓰도록 설정이 가능합니다
다만 이런 것들은 모두 어플리케이션 관점에서 볼 때 퍼포먼스에 영향을 주는 것입니디다. 레플리카 셋 중 몇에게
메모리의 데이터를 쓸 것인지, 메모리의 데이터에서 디스크로 쓸 때 저널과 얼마나 동기화를 맞출 지 하는 설정인 것입니다.

### Single Field Indexes

### Understanding Explain

### UnderStanding Explain Sharded Clusters

### Compound Indexes

#### Index Prefixes

### Sort With Index
